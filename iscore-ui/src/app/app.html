<div class="container">
  <h1 class="glow">{{ title }}</h1>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- The form for user input remains the same -->
  <form (ngSubmit)="checkScore()">
    <div class="form-group">
      <label for="nationalId">National ID:</label>
      <input
        type="text"
        id="nationalId"
        name="nationalId"
        [(ngModel)]="nationalIdInput"
        placeholder="Enter National ID"
        required>
    </div>
    <button type="submit" [disabled]="isLoading || !nationalIdInput">
      {{ isLoading ? 'Loading...' : 'Get Score' }}
    </button>
  </form>


  <div class="top-right-container">
    <img src="assets/images/icon.png" loading="lazy" alt="Icon" class="top-right-icon"/>
  </div>

  <!-- Display Area: Shows results or errors using new @-syntax -->
  <div class="results">

    @if (isLoading) {
    <div class="loading-spinner">
      <p>Contacting iScore service...</p>
    </div>
    }

    @if (scoreResponse) {
    <div class="score-card success">
      <h2>Inquiry Result</h2>
      <p><strong>National ID:</strong> {{ scoreResponse.nationalId }}</p>
      <p><strong>Segment:</strong> {{ scoreResponse.segment }}</p>
      <p class="score"><strong>iScore:</strong> {{ scoreResponse.iScore }}</p>
    </div>
    }

    @if (errorMessage) {
    <div class="score-card error">
      <h2>An Error Occurred</h2>
      <p>{{ errorMessage }}</p>
    </div>
    }

  </div>
  <hr class="form-separator">
  <form (ngSubmit)="createNewProfile()">
    <div class="form-group">
      <label for="newNationalId">National ID:</label>
      <input
        type="text"
        id="newNationalId"
        name="newNationalId"
        [(ngModel)]="newNationalId"
        placeholder="Enter new National ID"
        required>
    </div>

    <div class="form-group">
      <label for="newSegment">Risk Segment:</label>
      <!-- A dropdown is great for a fixed list of options -->
      <select id="newSegment" name="newSegment" [(ngModel)]="newSegment">
        <option value="standard">standard</option>
        <option value="highrisk">High Risk</option>
        <option value="Premium">Premiumn</option>
      </select>
    </div>

    <button type="submit" [disabled]="isLoading || !newNationalId">
      {{ isLoading ? 'Processing...' : 'Create Profile' }}
    </button>
  </form>
  <div class="results">

    <!-- This will only show if isLoading is true AND we triggered the create action -->
    @if (isLoading && !scoreResponse && !errorMessage) {
    <div class="loading-spinner">
      <p>Creating new profile...</p>
    </div>
    }

    <!-- Show this on successful creation -->
    @if (createResponse) {
    <div class="score-card success">
      <h2>Profile Created Successfully</h2>
      <p><strong>National ID:</strong> {{ createResponse.nationalId }}</p>
      <p><strong>Assigned Segment:</strong> {{ createResponse.segment }}</p>
      <p class="score"><strong>Generated iScore:</strong> {{ createResponse.generatedScore }}</p>
    </div>
    }

    <!-- Show this if the creation failed -->
    @if (createErrorMessage) {
    <div class="score-card error">
      <h2>An Error Occurred</h2>
      <p>{{ createErrorMessage }}</p>
    </div>
    }

</div>
</div>
